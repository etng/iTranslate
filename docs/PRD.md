# iTranslate 产品需求文档（PRD）

## 1. 目标

构建一个本地优先的翻译桌面工具，默认基于 Ollama `translategemma`，强调格式保真、历史可追溯、后续可扩展多模型。

## 2. 目标用户

- 需要本地离线/私有翻译的开发者、内容编辑者。
- 需要处理 Markdown/HTML 技术文档翻译的用户。

## 3. 范围

### 3.1 本期范围

- Tauri + React 桌面应用。
- 首次启动向导：Ollama 可达性与模型存在性验证。
- 翻译主流程：源语言/目标语言选择、输入、翻译、结果展示。
- HTML 输入自动转 Markdown 再翻译。
- 结果双视图：Markdown + 渲染 HTML。
- 历史记录与分页、详情只读回看、标题可编辑。
- 菜单：关于、检查更新。
- 单元测试与 e2e。

### 3.2 非本期范围

- 账号体系、云同步。
- 多语言 UI。
- 自动静默更新（本期保留确认下载安装）。

## 4. 关键业务规则

- 默认语言：源语言英语，目标语言简体中文。
- translategemma 请求必须包含官方 prompt format 前缀。
- 当输入疑似 HTML 时，先转 Markdown，再发起翻译。
- 翻译结果必须落历史。
- 打开历史详情不触发模型调用，不新增历史。
- 历史详情下语言选择器禁用，只展示记录值。
- 翻译引擎支持表格化管理（新增、编辑、启停、软删除、设为默认）。
- 引擎软删除后不得继续用于新翻译，但历史记录必须保留并标记“引擎已删除”。
- 当无可用引擎时，翻译页必须引导用户先去“翻译引擎”页面配置。
- 当无默认引擎时，翻译前必须显式选择一个引擎。
- 历史记录支持删除；从历史详情进入“继续编辑并重译”后，应覆盖更新当前历史项。

## 4.1 翻译引擎数据模型

- 核心字段：引擎名称、提供方、接口地址、模型标识。
- 可选凭据：API Token、用户名、密码（仅在需要时启用）。
- 状态字段：`enabled`、`deletedAt`（软删除）。
- 全局设置：`defaultEngineId`。

## 4.2 风险与约束

- 凭据当前保存在本地存储，适合本地开发/单机使用；若进入生产分发，建议迁移到系统凭据存储（如 macOS Keychain）。
- 不同提供方的接口协议可能不一致，本期先实现 `ollama` 与通用 `custom` 兼容层，后续逐步细化适配器。

## 5. 版本规则

- 版本号支持 `主.次.补丁.构建号`。
- 更新比较优先比较前三段，前三段相同再比较构建号。

## 6. 可扩展设计

- `TranslatorModelConfig` 作为统一模型配置。
- `TranslateProvider` 预留 `ollama/custom`。
- 翻译请求通过统一 `translateWithModel` 入口。

## 7. 验收标准

- 能在本机 Ollama + translategemma 环境完成翻译。
- HTML 输入可被转换并输出结构稳定结果。
- 历史分页可跳转多页，回退保留页码。
- 翻译引擎页面可完成新增、编辑、启停、软删除、默认切换。
- 软删除引擎后，历史记录可正常展示并标记删除状态。
- 可通过 seed 命令快速注入分页测试数据。
- 菜单项可触发关于与检查更新。
- `lint/test/e2e/cargo check` 全部通过。
